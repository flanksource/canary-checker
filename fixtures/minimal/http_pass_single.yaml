apiVersion: canaries.flanksource.com/v1
kind: Canary
metadata:
  name: http-pass-single
  labels:
    canary: http
spec:
  interval: 30
  http:
    - endpoint: https://httpbin.demo.aws.flanksource.com/status/200
      name: http-deprecated-endpoint
    - name: http-minimal-check
      url: https://httpbin.demo.aws.flanksource.com/status/200
      metrics:
        - name: httpbin_2xx_count
          type: counter
          value: "result.code == 200 ? 1 : 0"
          labels:
            name: '"httpbin_2xx_count"'
            check_name: "check.name"
            statusClass: "string(result.code).charAt(0)"
    - name: http-param-tests
      url: https://httpbin.demo.aws.flanksource.com/status/200
      responseCodes: [201, 200, 301]
      responseContent: ""
      maxSSLExpiry: 7
    - name: http-expr-tests
      url: https://httpbin.demo.aws.flanksource.com/status/200
      test:
        expr: "code in [200,201,301] && sslAge > Duration('7d')"
      display:
        template: "code={{.code}}, age={{.sslAge}}"
