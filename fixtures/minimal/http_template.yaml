apiVersion: canaries.flanksource.com/v1
kind: Canary
metadata:
  name: templated-http
spec:
  schedule: "@every 5m"
  http:
    - name: templated-http
      url: https://webhook.site/bf6a337a-4413-4839-9866-1d28ed96d65f
      responseCodes: [200]
      templateBody: true
      method: POST
      env:
        - name: db
          valueFrom:
            secretKeyRef:
              name: incident-commander-postgres
              key: POSTGRES_HOST
      body: |
        {
          "canary": "{{.canary.name}}",
          "secret": "{{.db}}"
        }
