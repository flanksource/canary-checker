
---
apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  annotations:
    controller-gen.kubebuilder.io/version: v0.4.0
  creationTimestamp: null
  name: canaries.canaries.flanksource.com
spec:
  group: canaries.flanksource.com
  names:
    kind: Canary
    listKind: CanaryList
    plural: canaries
    singular: canary
  scope: Namespaced
  versions:
  - additionalPrinterColumns:
    - jsonPath: .spec.interval
      name: Interval
      type: string
    - jsonPath: .status.status
      name: Status
      type: string
    - jsonPath: .status.message
      name: Message
      type: string
    - jsonPath: .status.uptime1h
      name: Uptime 1H
      type: string
    - jsonPath: .status.latency1h
      name: Latency 1H
      type: string
    - jsonPath: .status.lastTransitionedTime
      name: Last Transitioned
      type: date
    - jsonPath: .status.lastCheck
      name: Last Check
      type: date
    name: v1
    schema:
      openAPIV3Schema:
        description: Canary is the Schema for the canaries API
        properties:
          apiVersion:
            description: 'APIVersion defines the versioned schema of this representation
              of an object. Servers should convert recognized schemas to the latest
              internal value, and may reject unrecognized values. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#resources'
            type: string
          kind:
            description: 'Kind is a string value representing the REST resource this
              object represents. Servers may infer this from the endpoint the client
              submits requests to. Cannot be updated. In CamelCase. More info: https://git.k8s.io/community/contributors/devel/sig-architecture/api-conventions.md#types-kinds'
            type: string
          metadata:
            type: object
          spec:
            description: CanarySpec defines the desired state of Canary
            properties:
              containerd:
                items:
                  properties:
                    description:
                      type: string
                    expectedDigest:
                      type: string
                    expectedSize:
                      format: int64
                      type: integer
                    image:
                      type: string
                    password:
                      type: string
                    username:
                      type: string
                  type: object
                type: array
              containerdPush:
                items:
                  properties:
                    description:
                      type: string
                    image:
                      type: string
                    password:
                      type: string
                    username:
                      type: string
                  type: object
                type: array
              dns:
                items:
                  properties:
                    description:
                      type: string
                    exactreply:
                      items:
                        type: string
                      type: array
                    minrecords:
                      type: integer
                    port:
                      type: integer
                    query:
                      type: string
                    querytype:
                      type: string
                    server:
                      type: string
                    thresholdMillis:
                      type: integer
                    timeout:
                      type: integer
                  type: object
                type: array
              docker:
                items:
                  properties:
                    description:
                      type: string
                    expectedDigest:
                      type: string
                    expectedSize:
                      format: int64
                      type: integer
                    image:
                      type: string
                    password:
                      type: string
                    username:
                      type: string
                  type: object
                type: array
              dockerPush:
                items:
                  properties:
                    description:
                      type: string
                    image:
                      type: string
                    password:
                      type: string
                    username:
                      type: string
                  type: object
                type: array
              env:
                additionalProperties:
                  description: VarSource represents a source for a value
                  properties:
                    configMapKeyRef:
                      description: Selects a key of a ConfigMap.
                      properties:
                        key:
                          description: The key to select.
                          type: string
                        name:
                          description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                            TODO: Add other useful fields. apiVersion, kind, uid?'
                          type: string
                        optional:
                          description: Specify whether the ConfigMap or its key must
                            be defined
                          type: boolean
                      required:
                      - key
                      type: object
                    fieldRef:
                      description: 'Selects a field of the pod: supports metadata.name,
                        metadata.namespace, metadata.labels, metadata.annotations,
                        spec.nodeName, spec.serviceAccountName, status.hostIP, status.podIP,
                        status.podIPs.'
                      properties:
                        apiVersion:
                          description: Version of the schema the FieldPath is written
                            in terms of, defaults to "v1".
                          type: string
                        fieldPath:
                          description: Path of the field to select in the specified
                            API version.
                          type: string
                      required:
                      - fieldPath
                      type: object
                    secretKeyRef:
                      description: Selects a key of a secret in the pod's namespace
                      properties:
                        key:
                          description: The key of the secret to select from.  Must
                            be a valid secret key.
                          type: string
                        name:
                          description: 'Name of the referent. More info: https://kubernetes.io/docs/concepts/overview/working-with-objects/names/#names
                            TODO: Add other useful fields. apiVersion, kind, uid?'
                          type: string
                        optional:
                          description: Specify whether the Secret or its key must
                            be defined
                          type: boolean
                      required:
                      - key
                      type: object
                    value:
                      type: string
                  type: object
                type: object
              helm:
                items:
                  properties:
                    cafile:
                      type: string
                    chartmuseum:
                      type: string
                    description:
                      type: string
                    password:
                      type: string
                    project:
                      type: string
                    username:
                      type: string
                  type: object
                type: array
              http:
                items:
                  properties:
                    authentication:
                      description: 'Credentials for authentication headers:'
                      properties:
                        password:
                          properties:
                            name:
                              type: string
                            value:
                              type: string
                            valueFrom:
                              properties:
                                configMapKeyRef:
                                  properties:
                                    key:
                                      type: string
                                    name:
                                      type: string
                                    optional:
                                      type: boolean
                                  required:
                                  - key
                                  type: object
                                secretKeyRef:
                                  properties:
                                    key:
                                      type: string
                                    name:
                                      type: string
                                    optional:
                                      type: boolean
                                  required:
                                  - key
                                  type: object
                              type: object
                          required:
                          - name
                          type: object
                        username:
                          properties:
                            name:
                              type: string
                            value:
                              type: string
                            valueFrom:
                              properties:
                                configMapKeyRef:
                                  properties:
                                    key:
                                      type: string
                                    name:
                                      type: string
                                    optional:
                                      type: boolean
                                  required:
                                  - key
                                  type: object
                                secretKeyRef:
                                  properties:
                                    key:
                                      type: string
                                    name:
                                      type: string
                                    optional:
                                      type: boolean
                                  required:
                                  - key
                                  type: object
                              type: object
                          required:
                          - name
                          type: object
                      required:
                      - password
                      - username
                      type: object
                    body:
                      description: HTTP request body contents
                      type: string
                    description:
                      type: string
                    endpoint:
                      description: HTTP endpoint to check.  Mutually exclusive with
                        Namespace
                      type: string
                    headers:
                      description: HTTP Header fields to be used in the query
                      items:
                        properties:
                          name:
                            type: string
                          value:
                            type: string
                          valueFrom:
                            properties:
                              configMapKeyRef:
                                properties:
                                  key:
                                    type: string
                                  name:
                                    type: string
                                  optional:
                                    type: boolean
                                required:
                                - key
                                type: object
                              secretKeyRef:
                                properties:
                                  key:
                                    type: string
                                  name:
                                    type: string
                                  optional:
                                    type: boolean
                                required:
                                - key
                                type: object
                            type: object
                        required:
                        - name
                        type: object
                      type: array
                    maxSSLExpiry:
                      description: Maximum number of days until the SSL Certificate
                        expires.
                      type: integer
                    method:
                      description: HTTP method to call - defaults to GET
                      type: string
                    namespace:
                      description: Namespace to crawl for TLS endpoints.  Mutually
                        exclusive with Endpoint
                      type: string
                    ntlm:
                      description: NTLM when set to true will do authentication using
                        NTLM protocol
                      type: boolean
                    responseCodes:
                      description: Expected response codes for the HTTP Request.
                      items:
                        type: integer
                      type: array
                    responseContent:
                      description: Exact response content expected to be returned
                        by the endpoint.
                      type: string
                    responseJSONContent:
                      description: Path and value to of expect JSON response by the
                        endpoint
                      properties:
                        path:
                          type: string
                        value:
                          type: string
                      required:
                      - path
                      - value
                      type: object
                    thresholdMillis:
                      description: Maximum duration in milliseconds for the HTTP request.
                        It will fail the check if it takes longer.
                      type: integer
                  type: object
                type: array
              icmp:
                items:
                  properties:
                    description:
                      type: string
                    endpoint:
                      type: string
                    packetCount:
                      type: integer
                    packetLossThreshold:
                      format: int64
                      type: integer
                    thresholdMillis:
                      format: int64
                      type: integer
                  type: object
                type: array
              interval:
                format: int64
                type: integer
              jmeter:
                items:
                  properties:
                    description:
                      description: Description of the canary
                      type: string
                    host:
                      description: Host is the server against which test plan needs
                        to be executed
                      type: string
                    jmxFrom:
                      description: JmxFrom defines tge ConfigMap or Secret reference
                        to get the JMX test plan
                      properties:
                        name:
                          type: string
                        value:
                          type: string
                        valueFrom:
                          properties:
                            configMapKeyRef:
                              properties:
                                key:
                                  type: string
                                name:
                                  type: string
                                optional:
                                  type: boolean
                              required:
                              - key
                              type: object
                            secretKeyRef:
                              properties:
                                key:
                                  type: string
                                name:
                                  type: string
                                optional:
                                  type: boolean
                              required:
                              - key
                              type: object
                          type: object
                      required:
                      - name
                      type: object
                    port:
                      description: Port on which the server is running
                      format: int32
                      type: integer
                    properties:
                      description: Properties defines the local Jmeter properties
                      items:
                        type: string
                      type: array
                    systemProperties:
                      description: SystemProperties defines the java system property
                      items:
                        type: string
                      type: array
                  required:
                  - host
                  - jmxFrom
                  - port
                  type: object
                type: array
              ldap:
                items:
                  properties:
                    bindDN:
                      type: string
                    description:
                      type: string
                    host:
                      type: string
                    password:
                      type: string
                    skipTLSVerify:
                      type: boolean
                    userSearch:
                      type: string
                    username:
                      type: string
                  type: object
                type: array
              mssql:
                items:
                  properties:
                    connection:
                      type: string
                    description:
                      type: string
                    driver:
                      type: string
                    query:
                      type: string
                    results:
                      description: Number rows to check for
                      type: integer
                  type: object
                type: array
              namespace:
                items:
                  properties:
                    checkName:
                      type: string
                    deadline:
                      format: int64
                      type: integer
                    deleteTimeout:
                      format: int64
                      type: integer
                    description:
                      type: string
                    expectedContent:
                      type: string
                    expectedHttpStatuses:
                      items:
                        format: int64
                        type: integer
                      type: array
                    httpRetryInterval:
                      format: int64
                      type: integer
                    httpTimeout:
                      format: int64
                      type: integer
                    ingressHost:
                      type: string
                    ingressName:
                      type: string
                    ingressTimeout:
                      format: int64
                      type: integer
                    namespaceAnnotations:
                      additionalProperties:
                        type: string
                      type: object
                    namespaceLabels:
                      additionalProperties:
                        type: string
                      type: object
                    namespaceNamePrefix:
                      type: string
                    path:
                      type: string
                    podSpec:
                      type: string
                    port:
                      format: int64
                      type: integer
                    priorityClass:
                      type: string
                    readyTimeout:
                      format: int64
                      type: integer
                    schedule_timeout:
                      format: int64
                      type: integer
                  type: object
                type: array
              owner:
                type: string
              pod:
                items:
                  properties:
                    deadline:
                      format: int64
                      type: integer
                    deleteTimeout:
                      format: int64
                      type: integer
                    description:
                      type: string
                    expectedContent:
                      type: string
                    expectedHttpStatuses:
                      items:
                        type: integer
                      type: array
                    httpRetryInterval:
                      format: int64
                      type: integer
                    httpTimeout:
                      format: int64
                      type: integer
                    ingressHost:
                      type: string
                    ingressName:
                      type: string
                    ingressTimeout:
                      format: int64
                      type: integer
                    name:
                      type: string
                    namespace:
                      type: string
                    path:
                      type: string
                    port:
                      format: int64
                      type: integer
                    priorityClass:
                      type: string
                    readyTimeout:
                      format: int64
                      type: integer
                    scheduleTimeout:
                      format: int64
                      type: integer
                    spec:
                      type: string
                  type: object
                type: array
              postgres:
                items:
                  properties:
                    connection:
                      type: string
                    description:
                      type: string
                    driver:
                      type: string
                    query:
                      type: string
                    results:
                      description: Number rows to check for
                      type: integer
                  type: object
                type: array
              redis:
                items:
                  properties:
                    addr:
                      type: string
                    db:
                      type: integer
                    description:
                      type: string
                    password:
                      type: string
                    username:
                      type: string
                  required:
                  - addr
                  - db
                  type: object
                type: array
              restic:
                items:
                  properties:
                    accessKey:
                      description: AccessKey access key id for connection with aws
                        s3, minio, wasabi, alibaba oss
                      type: string
                    caCert:
                      description: CaCert path to the root cert. In case of self-signed
                        certificates
                      type: string
                    checkIntegrity:
                      description: CheckIntegrity when enabled will check the Integrity
                        and consistency of the restic reposiotry
                      type: boolean
                    description:
                      description: Description about the current restic canary check
                      type: string
                    maxAge:
                      description: MaxAge for backup freshness
                      type: string
                    password:
                      description: Password for the restic repository
                      type: string
                    repository:
                      description: 'Repository The restic repository path eg: rest:https://user:pass@host:8000/
                        or rest:https://host:8000/ or s3:s3.amazonaws.com/bucket_name'
                      type: string
                    secretKey:
                      description: SecretKey secret access key for connection with
                        aws s3, minio, wasabi, alibaba oss
                      type: string
                  required:
                  - maxAge
                  - password
                  - repository
                  type: object
                type: array
              s3:
                items:
                  properties:
                    accessKey:
                      type: string
                    bucket:
                      properties:
                        endpoint:
                          type: string
                        name:
                          type: string
                        region:
                          type: string
                      type: object
                    description:
                      type: string
                    objectPath:
                      type: string
                    secretKey:
                      type: string
                    skipTLSVerify:
                      description: Skip TLS verify when connecting to s3
                      type: boolean
                  type: object
                type: array
              s3Bucket:
                items:
                  properties:
                    accessKey:
                      type: string
                    bucket:
                      type: string
                    description:
                      type: string
                    endpoint:
                      type: string
                    maxAge:
                      description: maximum allowed age of matched objects in seconds
                      format: int64
                      type: integer
                    minSize:
                      description: min size of of most recent matched object in bytes
                      format: int64
                      type: integer
                    objectPath:
                      description: glob path to restrict matches to a subset
                      type: string
                    readWrite:
                      type: boolean
                    region:
                      type: string
                    secretKey:
                      type: string
                    skipTLSVerify:
                      description: Skip TLS verify when connecting to s3
                      type: boolean
                    usePathStyle:
                      description: 'Use path style path: http://s3.amazonaws.com/BUCKET/KEY
                        instead of http://BUCKET.s3.amazonaws.com/KEY'
                      type: boolean
                  type: object
                type: array
              severity:
                type: string
              tcp:
                items:
                  properties:
                    description:
                      type: string
                    endpoint:
                      type: string
                    thresholdMillis:
                      format: int64
                      type: integer
                  type: object
                type: array
            type: object
          status:
            description: CanaryStatus defines the observed state of Canary
            properties:
              lastCheck:
                format: date-time
                type: string
              lastTransitionedTime:
                format: date-time
                type: string
              latency1h:
                description: Average latency to complete all checks
                type: string
              message:
                type: string
              observedGeneration:
                description: If set, this represents the .metadata.generation that
                  the status was set for
                format: int64
                type: integer
              status:
                type: string
              uptime1h:
                description: Availibility over a rolling 1h period
                type: string
            type: object
        type: object
    served: true
    storage: true
    subresources:
      status: {}
status:
  acceptedNames:
    kind: ""
    plural: ""
  conditions: []
  storedVersions: []
